$('.adventures-command-container').fadeIn();
$('#timer-box').fadeIn();

const elmMin = document.querySelector(".min");
const elmSec = document.querySelector(".sec");
var quest_finished = false

function countdown() {
  const nowTime = new Date(); // 現在時刻を取得
  const startTime = new Date('<%= @quest.start_time.iso8601 %>'); //クエストを始めた時間
  const finish = <%= @quest.set_seconds - @stop_time %> // クエスト時間
  const finishTime = new Date(startTime.getTime() + finish * 1000 ); //クエスト終了時刻をセット
  const diff = finishTime.getTime() - nowTime.getTime(); // 時間の差を取得（ミリ秒）

  // ミリ秒から単位を修正
  const calcMin = Math.floor(diff / 1000 / 60) % 60;
  const calcSec = Math.floor(diff / 1000) % 60;

  // 取得した時間を表示（2桁表示）
  elmMin.textContent = String(calcMin).padStart(2, "0");
  elmSec.textContent = String(calcSec).padStart(2, "0");

  // 終了時刻との差が1秒より小さい場合
  if (diff < 1 ) {
    clearInterval(countdown)
    document.querySelector(".timer-text").textContent = String("おつかれさまでした！");
    quest_finished = true
  }
};

if (quest_finished == false) {
  countdown();
  setInterval(countdown, 1000);
} else {
  clearInterval(countdown);
}