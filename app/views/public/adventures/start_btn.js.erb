$('.adventures-command-container').fadeIn();
$('#timer-box').fadeIn();

const elmMin = document.querySelector(".min");
const elmSec = document.querySelector(".sec");
var quest_finished = false;
let startTime = new Date('<%= @quest.start_time.iso8601 %>'); //クエストを始めた時間
let finish = <%= @quest.set_seconds - @study_time %>; // クエスト時間

// タイマー
function countdown() {
  const nowTime = new Date(); // 現在時刻を取得
  let finishTime = new Date(startTime.getTime() + finish * 1000 ); //クエスト終了時刻をセット
  let diff = finishTime.getTime() - nowTime.getTime(); // 時間の差を取得（ミリ秒）

  // ミリ秒から単位を修正
  const calcMin = Math.floor(diff / 1000 / 60) % 60;
  const calcSec = Math.floor(diff / 1000) % 60;

  // 取得した時間を表示（2桁表示）
  elmMin.textContent = String(calcMin).padStart(2, "0");
  elmSec.textContent = String(calcSec).padStart(2, "0");

  // 終了時刻との差が1秒より小さい場合
  if (diff < 1 ) {
    clearInterval(timerId);
    document.querySelector(".timer-text").textContent = String("おつかれさまでした！");
    quest_finished = true
  }
};

// エンカウント機能

countdown();
let timerId = setInterval(countdown, 1000);